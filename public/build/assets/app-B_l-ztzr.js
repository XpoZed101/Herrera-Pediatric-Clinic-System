(function(){function a(n){if(window.Swal&&typeof window.Swal.fire=="function"){n(window.Swal);return}const s=document.createElement("script");s.src="https://cdn.jsdelivr.net/npm/sweetalert2@11",s.async=!0,s.onload=function(){n(window.Swal)},document.head.appendChild(s)}function e(n){const s=document.getElementById("flash-messages");if(!s)return;const i=s.dataset.status||"",l=s.dataset.statusUpdated||"",m=s.dataset.emailSent||"",d=s.dataset.error||"",r=(c,u,f="success")=>{n.fire({icon:f,title:c,text:u,toast:!0,position:"top-end",timer:2500,showConfirmButton:!1})};d?r("Error",d,"error"):m?r("Email Sent",m,"success"):l?r("Status Updated",l,"success"):i&&r("Success",i,"success")}function o(n){Array.from(document.querySelectorAll("form.js-confirm, form[data-confirm]")).forEach(i=>{i.__swalHooked||(i.__swalHooked=!0,i.addEventListener("submit",async l=>{if(i.__swalSubmitting)return;l.preventDefault();const m=i.getAttribute("data-confirm-title")||"Are you sure?";let d=i.getAttribute("data-confirm-text")||"This will change records.";const r=i.getAttribute("data-confirm-submit-text")||"Confirm",c=i.querySelector('select[name="status"]'),u=c?c.options[c.selectedIndex]?.text||c.value:"";u&&(d=`${d} New status: ${u}.`),(await n.fire({icon:"question",title:m,text:d,showCancelButton:!0,confirmButtonText:r,cancelButtonText:"Cancel",confirmButtonColor:"#2563eb"})).isConfirmed&&(i.__swalSubmitting=!0,i.submit())}))})}function t(n){const s=()=>{e(n),o(n)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",s):s()}a(t)})();function v(a){return new Promise(function(e,o){var t=document.createElement("script");t.src=a,t.async=!0,t.onload=e,t.onerror=o,document.head.appendChild(t)})}function g(a,e){try{var o=a.getAttribute(e);return!o||o==="null"?null:JSON.parse(o)}catch{return null}}async function y(){var a=document.getElementById("register-data");if(a){window.jQuery||await v("https://code.jquery.com/jquery-3.7.1.min.js"),window.Swal||await v("https://cdn.jsdelivr.net/npm/sweetalert2@11");var e=window.jQuery,o=window.Swal;e(function(){var t=g(a,"data-errors")||[],n=g(a,"data-success"),s=g(a,"data-error");t&&t.length?o.fire({icon:"error",title:"Please fix the following",html:'<div class="text-left space-y-1">'+t.map(function(i){return"<div>â€¢ "+i+"</div>"}).join("")+"</div>",confirmButtonText:"OK",confirmButtonColor:"#0ea5e9",width:520}):n?o.fire({icon:"success",title:"Saved",text:n,timer:1800,showConfirmButton:!1}):s&&o.fire({icon:"error",title:"Error",text:s,confirmButtonText:"OK",confirmButtonColor:"#0ea5e9"})})}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",y):y();function x(){return new Promise(a=>{if(window.Swal)return a(window.Swal);const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/sweetalert2@11",e.async=!0,e.onload=()=>a(window.Swal),document.head.appendChild(e)})}async function T(){const a=document.getElementById("admin-appointments-page");if(!a)return;const e=a.dataset.statusUpdated||"",o=a.dataset.emailSent||"";if(e||o){const t=await x(),n=!!o;t.fire({icon:"success",title:n?"Email Sent":"Status Updated",text:n?o:e,confirmButtonText:"OK"})}}document.addEventListener("DOMContentLoaded",T);function S(){return new Promise(a=>{if(window.Swal)return a(window.Swal);const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/sweetalert2@11",e.async=!0,e.onload=()=>a(window.Swal),document.head.appendChild(e)})}(async function(){const e=await S();window.__statusUpdatesBound||(document.addEventListener("submit",async o=>{const t=o.target;if(!t||!t.matches("form.js-confirm"))return;o.preventDefault();const n=t.dataset.confirmTitle||"Confirm Action",s=t.dataset.confirmText||"Are you sure you want to proceed?",i=t.dataset.confirmSubmitText||"Proceed";if(!(await e.fire({title:n,text:s,icon:"question",showCancelButton:!0,confirmButtonText:i,cancelButtonText:"Cancel"})).isConfirmed)return;if(e.fire({title:"Processing...",text:"Please wait while we process your request.",allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1,didOpen:()=>e.showLoading()}),/\/status$/.test(t.action)){try{const d=new FormData(t),r=await fetch(t.action,{method:t.method||"POST",headers:{Accept:"application/json"},body:d});if(!r.ok)throw new Error(`HTTP ${r.status}`);const c=await r.json();await e.fire({icon:"success",title:c?.email_sent?"Email Queued":"Status Updated",text:c?.message||"Waitlist updated.",confirmButtonText:"OK"}),window.location.reload()}catch{e.close(),t.submit()}return}e.close(),t.submit()}),document.addEventListener("change",async o=>{const t=o.target;if(!t||t.tagName!=="SELECT")return;const n=t.closest("form");if(!n||!/\/status$/.test(n.action))return;const s=t.value,i=t.options[t.selectedIndex]?.text||s,l=t.getAttribute("data-prev")||t.defaultValue||s;if(!(await e.fire({title:"Update status?",text:`Change appointment status to "${i}"?`,icon:"question",showCancelButton:!0,confirmButtonText:"Update",cancelButtonText:"Cancel"})).isConfirmed){t.value=l;return}e.fire({title:"Updating status...",allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1,didOpen:()=>e.showLoading()});try{const d=new FormData(n),r=await fetch(n.action,{method:n.method||"POST",headers:{Accept:"application/json"},body:d});if(!r.ok)throw new Error(`HTTP ${r.status}`);const c=await r.json();await e.fire({icon:"success",title:"Status Updated",text:c?.message||"Appointment status updated.",confirmButtonText:"OK"}),t.setAttribute("data-prev",s)}catch{t.value=l,await e.fire({icon:"error",title:"Update failed",text:"Could not update status. Falling back to standard submission."}),n.submit()}}),window.__statusUpdatesBound=!0)})();async function C(){const a=await S(),e=document.getElementById("flash-messages");if(!e)return;const{statusUpdated:o,emailSent:t,error:n}=e.dataset;if(n){a.fire({icon:"error",title:"Error",text:n,confirmButtonText:"OK"});return}if(o||t){const s=t||o,i=!!t;a.fire({icon:"success",title:i?"Email Sent":"Status Updated",text:s,confirmButtonText:"OK"})}}document.addEventListener("DOMContentLoaded",C);document.addEventListener("livewire:navigated",C);(()=>{const a=r=>{if(typeof Chart<"u")return r();const c=document.createElement("script");c.src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js",c.onload=r,document.head.appendChild(c)},e=["#f59e0b","#3b82f6","#10b981","#ef4444","#6366f1"],o=(r,c,u,f)=>{const p=document.getElementById(r);p&&a(()=>{const w=Chart.getChart(p);if(w)w.data.labels=c,w.data.datasets[0].data=u,w.data.datasets[0].backgroundColor=f.slice(0,u.length),w.update();else{const h=p.getContext("2d");new Chart(h,{type:"doughnut",data:{labels:c,datasets:[{data:u,backgroundColor:f.slice(0,u.length)}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"},tooltip:{enabled:!0}}}})}})},t=()=>{const r=document.getElementById("statusDoughnut"),c=document.getElementById("visitTypeDoughnut"),u=(E,b)=>{try{return JSON.parse(E?.dataset?.[b]||"[]")}catch{return[]}},f=u(r,"labels"),p=u(r,"counts"),w=u(c,"labels"),h=u(c,"counts");o("statusDoughnut",f,p,e),o("visitTypeDoughnut",w,h,e)};let n;const s=()=>{i();const r=()=>{fetch("/admin/dashboard/stats",{credentials:"same-origin",cache:"no-store",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(c=>c.json()).then(c=>{const{statusLabels:u=[],statusCounts:f=[],visitTypeLabels:p=[],visitTypeCounts:w=[]}=c||{};o("statusDoughnut",u,f,e),o("visitTypeDoughnut",p,w,e)}).catch(()=>{})};r(),n=setInterval(r,5e3)},i=()=>{n&&(clearInterval(n),n=null)},l=()=>!!(document.getElementById("statusDoughnut")||document.getElementById("visitTypeDoughnut"));let m;const d=()=>{if(l()){t(),s();return}m&&m.disconnect(),m=new MutationObserver(()=>{l()&&(m.disconnect(),t(),s())}),m.observe(document.body,{childList:!0,subtree:!0})};document.addEventListener("DOMContentLoaded",d),window.addEventListener("pageshow",d),document.addEventListener("turbo:load",d),document.addEventListener("livewire:load",d),document.addEventListener("livewire:navigated",d),document.addEventListener("visibilitychange",()=>{if(!l()){i();return}document.hidden?i():s()}),window.addEventListener("focus",()=>{l()&&s()}),window.addEventListener("blur",i)})();
